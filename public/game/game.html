<!doctype html>
<html lang="en">
	<head>
		<!-- Required meta tags -->
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=yes">
		<!-- Bootstrap CSS -->
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
		<title>Crow Game</title>
	</head>
	<body>
		<div class="container-fluid" style="">
			<div class="col-12 d-flex" >
			</div>
			<div class="row">
				<div id="body" class=" mt-3 ml-1 row col-lg-9 container-fluid " >
					<div class="d-none d-sm-block col-md-2 flex-wrap" id="question-image" >
						<img src="/Users/s129527/Downloads/yes.png" class=" ml-4 rounded" width="95px" style=" max-width: 100%">
					</div>
					<div	class="p-1 col-md-9 rounded ">
						<div id="questionContainer" class="col-md-12 pre-scrollable  rounded" style=" height:85px; background-color: #E4E4E4 ">
							<p id="question">		Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto. </p>
						</div>
					</div>
					<container id="answerContainer" class="inner bd-example p-1 col-xs-auto container-fluid rounded" style=" overflow-y: scroll; height: 65vh">
						<div id="answerSection" class="d-flex text-white pre-scrollable align-content-stretch flex-wrap bd-highlight " style="min-height: 420px;" >
						</div>
					</container>
				</div>
				<div id="tableSection" class="col-sm-3 rounded " style=" ">
					<div class="mt-3  rounded-top text-truncate text-center ml-4" style="background-color: #E4E4E4">
						<h3>Users</h3>
					</div>
					<div id="userTable" class=" rounded-bottom  pre-scrollable text-truncate text-center ml-4 " style="max-height: 475px ;background-color: #E4E4E4">
					</div>
				</div>
			</div>
			<div id="inputSection" class="justify-content-center mb-1 col-12 ml-2 p-2 row">
				<button id="joinGame" type="button" style="background-color: #f88379" class="text-white btn btn-lg " data-toggle="modal" data-target="#secondModal">Join Game</button>
	      <div class="modal fade" id="secondModal">
	         <div class="modal-dialog">
	           <div class="modal-content">

	             <!-- Modal Header -->
	             <div class="modal-header">
	               <h4 class="modal-title">Join Game</h4>
	               <button type="button" class="close" data-dismiss="modal"> </button>
	             </div>

	             <!-- Modal body -->
	             <div class="modal-body">
	               <div class="form-group">

	                    <input type="text" placeholder="Name" class="form-control" id="usr">
	                  </div>


	             </div>

	             <!-- Modal footer -->
	             <div class="modal-footer">
	               <button type="button" class="btn btn-info" data-dismiss="modal" onclick="pageShowInputBox()">Join</button>
	             </div>

	           </div>
	         </div>
	       </div>

			</div>
		</div>
		<!-- Optional JavaScript -->
		<!-- jQuery first, then Popper.js, then Bootstrap JS -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
		<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    	<script src="lib/bootstrap-4.0.0/js/bootstrap.bundle.min.js"></script>
		<script src="lib/socket.io.slim.2.0.4.js"></script>
		<script>
				var socket = io();
				var g;

				/*
				 * Room Functions
				*/
				// joins the socket room for the game
				function joinRoom(){
					socket.emit('joinRoom',getURL(), function(game){
					update(game);
					});
				}

				// gets the current visited URL
				function getURL(){
					return window.location.pathname.substring(1);
				}

				// the server's ping of game data
				socket.on('roomPing', function(game){
					if(game.time>g.time){
					update(game);
					}
				});

				// downloads the game's data
				function downloadGameData(){
					socket.emit('getDataDownload', function(data){
					var fileName = getURL()+(new Date()).toISOString().slice(0,10).replace(/-/g,"") + ".txt";
					saveFile(fileName,data);
					});
				}

				// saves the passed parameter of data as filename
				function saveFile(filename, data) {
					var blob = new Blob([data], {type: 'text/csv'});
					if(window.navigator.msSaveOrOpenBlob) {
						window.navigator.msSaveBlob(blob, filename);
					}
					else{
						var elem = window.document.createElement('a');
						elem.href = window.URL.createObjectURL(blob);
						elem.download = filename;
						document.body.appendChild(elem);
						elem.click();
						document.body.removeChild(elem);
					}
				}
				// updates based on game data
				function update(game){
					if(!game.ongoing){
						// TODO: show end game
					}
					if(game.queston != g.question){
						pageNewQuestion(game.question);
					}

					pageSetUsers(game.players);
					pageSetAnswers(game.answers)

					g = game;
				}

				/*
				 * Player Functions
				*/
				// requests to join a game
				function joinGame(playerName){
					var player = {name: playerName};
					//player.name = playerName;
					player.reacts = [];
					socket.emit('joinGame',player);
				}

				// requests to react to player with an action (String) agree/disagree/star
				function react(player, action){
					socket.emit('react',player,action);
				}

				// request to submit user answer
				function submitAnswer(answer){
					socket.emit('submitAnswer', answer);
				}

				/*
				 * Questioner Functions
				*/
				function askQuestion(question){
					socket.emit('askQuestion',question);
				}

				/*
				 * Owner Functions
				*/

				// requests to create a game
				// questionerMode - the mode of how the questioner changes owner/random/sequential
				function createGame(questionerMode){
					socket.emit('createGame', questionerMode);
				}

				// requests to go to the next question
				function nextQuestion(){
					socket.emit('nextQuestion');
				}

				// requests the server to end the game
				function endGame(){
					socket.emit('endGame');
				}

				/*
				 * Page Functions
				*/
				function pageSetUsers(users){
					pageRemoveAllUsers();
				}

				function pageSetAnswers(answers){
					pageRemoveAllAnswers();
				}

				function pageAddUser(name) {
					var userText = document.createElement("p");
					var text = document.createTextNode(name);
					userText.appendChild(text);
					document.getElementById("userTable").appendChild(userText);
					userText.setAttribute("class","m-2 font-weight-light ");
					userText.setAttribute("style","background-color: #E4E4E4");
				}

				function pageRemoveUser(name) {
					document.getElementById("LMAO SORRY CJ").remove();
				}

				function pageRemoveAllUsers(){
        			var userList = document.getElementById("userTable");
        			while (userList.hasChildNodes()) {
        				userList.removeChild(userList.firstChild);
        			}
      			}

				function pageNewQuestion(question) {
					var container = document.getElementById("questionContainer");
					var text = document.getElementById("question");
					var para = document.createElement("p");
					var node = document.createTextNode(question);
					para.appendChild(node);
					container.replaceChild(para,text);
				}

				function pageShowAnswer(name) {
					var x = document.createElement("DIV");
					x.setAttribute("id", "answerEnlarge");
				}

				function pageShowInputBox() {
	        var section = document.getElementById("inputSection");
	        var textBox = document.createElement("textarea");
	        var joinButton = document.getElementById("joinGame");
	        textBox.setAttribute("class", "form-control col-11");
	        textBox.setAttribute("rows", "3");
	        textBox.setAttribute("placeholder", "Your Answer:");
	        section.appendChild(textBox);
	        joinButton.remove(joinButton);
	      }

				function pageHideAnswer(name) {
					var x = document.createElement("DIV");
					x.setAttribute("id", "answerEnlarge");
				}

				function pageRemoveAllAnswers() {
        			var section = document.getElementById("answerSection");
        			while (section.hasChildNodes()) {
          				section.removeChild(section.firstChild);
        			}
     			}

				function pageAddAnswer(user, answer) {
					var container = document.getElementById("answerContainer");
					var section = document.getElementById("answerSection");

					var newUser = document.createElement("h3");
					var newDiv = document.createElement("div");

					newDiv.setAttribute("class", "p-2  pre-scrollable col m-1 rounded border");
					newDiv.setAttribute("style", "background-color: #E4E4E4;min-width:220px");

					var para = document.createElement("p");
					para.setAttribute("class", "p-2");
					var answerText = document.createTextNode(answer);
					var userText = document.createTextNode(user);

					newUser.appendChild(userText);
					newDiv.appendChild(newUser);

					para.appendChild(answerText);
					newDiv.appendChild(para);
					section.appendChild(newDiv);
					container.appendChild(section);
				}


				joinRoom();
		</script>
	</body>
</html>
